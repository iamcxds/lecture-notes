\chapter{Sheaf}\label{chap:Sheaf} % (fold)

As we mentioned early, presheaf is analogue of "linear functional", to get a category of generalized space, we need to impose the "continuous" condition, And sheaf is such "continuous" presheaf. 

In analysis, continuous means preserve the limit, i.e. $f(\lim x_i)=\lim f(x_i)$. So we should also define limit in category, in some sense it describes how to approximate an object by others.

Some reference can be found in \cite{maclane2012sheaves}. 
\section{Limit and Colimit}

Let's begin with the easiest example of analysis: the limit of an increasing sequence.

If we view the real number poset $(\bR, \leq)$ as a category. Then an increasing sequence is an order preserving map from $(\mathbb{N},\leq)$ to $\bR$. i.e a functorr
$a_{(-)}:\mathbb{N} \to \bR$. Let us unwind the definition of the limit $ \lim a_i$: it is the supremum of $\{a_i\}$, i.e
\[
 \forall b\in \bR, \forall i \in \mathbb{N}, a_i \leq b \Leftrightarrow \lim a_i \leq b
\]
Recall for the poset category, morphism $ \Hom_{\bR}(a,b)$ can be seen as the proofs of propsition $a\leq b$: if there a morphism, $a \leq b$ is true, otherwise the proofs is empty, it is false. So we can rewrite it as
\[
  \forall b\in \bR, \prod_{ i \in \mathbb{N}} \Hom_\bR(a_i , b) \cong \Hom_\bR(\lim a_i, b)
\]
So we can think the limit is formally defined as a pre(co)sheaf $b \mapsto \lim h^{a_i}(b)$, and then if we can find an object who represent this pre(co)sheaf as $h^{\lim a_i}$, the limit exists as this object.

Then next example we consider a functor $X_{(-)}: \mathbb{N} \to \Set$, we should intuitively think it limit is $\bigcup_{i\in \mathbb{N}} X_i$, in this case it is called \textbf{Colimit}. But if we compare to the previous formula, we just get an inclusion:
\[
  \forall A\in \Set, \prod_{ i \in \mathbb{N}} \Hom_\Set(X_i , A) \supseteq \Hom_\Set(\bigcup_{i\in \mathbb{N}} X_i, A)
\]

The reason for this is we also need to ask the morphisms $ f_i \in \Hom_\Set(X_i , A)$ compactible which the morphism from functor $X_{i\leq j}:X_i\to X_{j}$, that is to say $f_i = f_j \circ X_{i\leq j}$.
% https://q.uiver.app/#q=WzAsNSxbMSwwLCJYX2kiXSxbMiwwLCJYX3tpKzF9Il0sWzMsMCwiXFxjZG90cyJdLFsxLDEsIkEiXSxbMCwwLCJcXGNkb3RzIl0sWzAsMSwiWF97aVxcbGVxIGkrMX0iXSxbMSwyLCJYX3tpKzFcXGxlcSBpKzJ9Il0sWzAsMywiZl9pIiwxXSxbMSwzLCJmX3tpKzF9IiwxXSxbMiwzXSxbNCwwLCJYX3tpLTFcXGxlcSBpfSJdLFs0LDNdXQ==
\[\begin{tikzcd}[ampersand replacement=\&,cramped]
	\cdots \& {X_i} \& {X_{i+1}} \& \cdots \\
	\& A
	\arrow["{X_{i-1\leq i}}", from=1-1, to=1-2]
	\arrow[from=1-1, to=2-2]
	\arrow["{X_{i\leq i+1}}", from=1-2, to=1-3]
	\arrow["{f_i}"{description}, from=1-2, to=2-2]
	\arrow["{X_{i+1\leq i+2}}", from=1-3, to=1-4]
	\arrow["{f_{i+1}}"{description}, from=1-3, to=2-2]
	\arrow[from=1-4, to=2-2]
\end{tikzcd}\]
This motivates us to give the definition of Limit and Colimit:
\begin{definition}[Limit and Colimit of Set]
  Let $D : J \to \mathbf{Set}$ be a diagram(functor) of sets indexed by a small category $J$. The \emph{limit} of $D$, denoted $\Lim_J D$, is the subset of the product
\[
\prod_{j \in J} D(j)
\]
consisting of all families $(x_j)_{j \in J}$ such that for every morphism $f : i \to j$ in $J$, we have $D(f)(x_i) = x_j$.

The \emph{colimit} of $D$, denoted $\Colim_J D$, is the quotient of the disjoint union
\[
\bigsqcup_{j \in J} D(j)
\]
by the equivalence relation generated by $x \sim D(f)(x)$ for every morphism $f : i \to j$ in $J$ and every $x \in D(i)$.
\end{definition}
We will omit $J$ sometimes.
\begin{remark}
 The intuition of limit is gluing functions, of colimit is gluing space. Image there is a covering of spaces $\bigcup X_i\to X$, to gluing space we start from $\bigsqcup X_i$ then we identify the intersections $X_i\cap X_j\hookrightarrow X_i,X_j$; To gluing function on $C(X_i)$ we start with $\prod C(X_i)$ then we impose compactibility condition when restrict to $C(X_i\cap X_j)$.
\end{remark}
\begin{exercise}
  If we view  $i \mapsto \Hom_\Set(X_i , A)$ as functor $ h_A(X_{(-)}): \mathbb{N}^\op \to \Set $, Then we have the relation between limit and colimit:
\[
  \forall A\in \Set, \Lim_{i\in \mathbb{N}^\op} \Hom_\Set(X_i , A) \cong \Hom_\Set(\Colim_{i\in \mathbb{N}} X_i, A)
\]
Show that this is hold in general for all category $J$
\[
  \forall A\in \Set, \Lim_{j\in J^\op} \Hom_\Set(X_j , A) \cong \Hom_\Set(\Colim_{j\in J} X_j, A)
\]
\[
  \forall A\in \Set, \Lim_{j\in J} \Hom_\Set(A, X_j ) \cong \Hom_\Set(A, \Lim_{j\in J} X_j)
\]
\end{exercise}
\begin{exercise}
  Consider the category of functor $ \Fun(J,\Set)$ where the morphism is natural transformation. For $A\in \Set$ let $c(A) \in \Fun(J,\Set)$ be the const functor. Show that 
\[
  \Hom_{\Fun(J,\Set)}(X_{(-)},c(A)) \cong \Lim_{j\in J^\op} \Hom_\Set(X_j , A) 
\]
\[
  \Hom_{\Fun(J,\Set)}(c(A),X_{(-)}) \cong \Lim_{j\in J} \Hom_\Set(A, X_i ) 
\]
\end{exercise}
\begin{example}
  \begin{itemize}
    \item \textbf{Product and Coproduct:} \\
      Consider the set $J$ viewed as a discrete category  and no non-identity morphisms. A functor $D : J \to \mathbf{Set}$ is simply a family of sets $\{A_j\}_{j\in J}$. The limit of $D$ is the product set $\prod_{j\in J} A_j$ and the colimit is the coproduct (disjoint union) $\bigsqcup_{j\in J} A_j$.

    \item \textbf{Equalizer and Coequalizer:} \\
    Let $J$ be the category with two objects $\alpha,\beta$ and two parallel morphisms $f, g : \alpha \to \beta$. A functor $D : J \to \mathbf{Set}$ consists of sets $A, B$ and functions $f, g : A \to B$. The limit (equalizer) is:
    \[
      \Lim D = \mathrm{Eq}(f,g):= \{ a \in A \mid f(a) = g(a) \}.
    \]
    And the colimit (coequalizer) is the quotient set:
    \[
    \Colim D = \mathrm{Coeq}(f,g):=B / \sim
    \]
    where $b \sim b'$ if there exists $a \in A$ such that $f(a) = b$ and $g(a) = b'$.
    \item \textbf{Pullback and Pushout: } \\
    Let $J$ be the diagram $\alpha \xrightarrow{f} \gamma \xleftarrow{g} \beta$. A functor $D : J \to \mathbf{Set}$ assigns sets $X, Y, Z$ and functions $f : X \to Z$, $g : Y \to Z$. The limit (pullback) is:
    \[
    \Lim D = X \times_Z Y := \{ (x, y) \in X \times Y \mid f(x) = g(y) \}.
    \]
  And the colimit (pushout) is:
    \[
    \Colim D = X \sqcup_Z Y := (X \sqcup Y) / \sim
    \]
    where $\sim$ is the equivalence relation generated by $f(z) \sim g(z)$ for all $z \in Z$.

   \end{itemize}
\end{example}
\begin{remark}
  Actually these are all essential limit and colimit: limit can be seen as equalizer of product and colimit can be seen as coequalizer of coproduct:

  Limit:
\begin{itemize}
    \item Consider the product $\prod_{j \in J} D(j)$.
    \item For each morphism $f : i \to j$ in $J$, define two morphisms:
    \begin{align*}
        \alpha, \beta : \prod_{j \in J} D(j) \to \prod_{f : i \to j} D(j)
    \end{align*}
    where $\alpha$ sends $(x_j)_{j \in J}$ to $(D(f)(x_i))_{f : i \to j}$ and $\beta$ sends $(x_j)_{j \in J}$ to $(x_j)_{f : i \to j}$.
    \item The limit $\Lim D$ is the equalizer of $\alpha$ and $\beta$:
    \[
    \Lim D = \mathrm{Eq}(\alpha, \beta).
    \]
\end{itemize}
Colimit:
\begin{itemize}
    \item Consider the coproduct $\coprod_{j \in J} D(j)$.
    \item For each morphism $f : i \to j$ in $J$, define two morphisms:
    \begin{align*}
        \alpha', \beta' : \bigsqcup_{f : i \to j} D(i) \to \bigsqcup_{j \in J} D(j)
    \end{align*}
    where $\alpha'$ sends $x \in D(i)$ (in the $f : i \to j$ summand) to $D(f)(x) \in D(j)$, and $\beta'$ sends $x \in D(i)$ to $x$ viewed in $D(i)$.
    \item The colimit $\Colim D$ is the coequalizer of $\alpha'$ and $\beta'$:
    \[
    \Colim D = \mathrm{Coeq}(\alpha', \beta').
    \]
\end{itemize}
\end{remark}

\begin{remark}[Homotopy (Co)limit]
  
\end{remark}

To definite limit and colimit for general category, we can make use of morphism:
\begin{definition}[Limit and Colimit]
  Let $\mathcal{C}$ be a category, $J$ a small category, and $D : J \to \mathcal{C}$ a functor (called a diagram in $\mathcal{C}$). A \emph{limit} of $D$ is an object $\Lim_J D$ of $\mathcal{C}$ such that 
\[
  \forall A\in \cC, \Lim_{j\in J} \Hom_\cC(A, D(j) ) \cong \Hom_\cC(A, \Lim_{J} D)
\]
A \emph{colimit} of $D$ is an object $\Colim_J D$ of $\mathcal{C}$ such that
\[
  \forall A\in \cC, \Lim_{j\in J^\op} \Hom_\cC(D(j) , A) \cong \Hom_\cC(\Colim_{ J} D, A)
\]
\end{definition}
\begin{example}[Poset and Lattice]
 In a thin category come from poset $P$ we have the $\Lim p $ is the meet $\bigwedge p$, and the colimit $\Colim p$ is the joint $ \bigvee p$. Then the thin category admitted all limit and colimit is a complete lattice.
\end{example}

Thanks to Yoneda lemma, to understand stand (co)limit of general category, we only need to understand its presheaf, and thus limit of $\Set$.


Then we introduce an important kind of colimit, \emph{filtered colimit}. 
\begin{definition}[Filtered Category]
  A small category $J$ is called \emph{filtered} if:
  \begin{enumerate}
        \item It is non-empty.
              \item For every pair of objects $j_1, j_2 \in \mathrm{Ob}(J)$, there exists an object $k \in \mathrm{Ob}(J)$ and morphisms $j_1 \to k$ and $j_2 \to k$.
                    \item For every pair of parallel morphisms $f, g : j \to j'$ in $J$, there exists an object $k$ and a morphism $h : j' \to k$ such that $h \circ f = h \circ g$.
  \end{enumerate}
\end{definition} 
\begin{example}
 For the category of open set $\Op(X)$, both $\Op(X)$ and $\Op(X)^\op$ are filtered
\end{example}
\begin{exercise}
 Let $I$ be any finite category, i.e with finite objects and morphisms, then for any functor $F:I\to J$, Show that $J$ is filtered iff there exists a object $j_F \in J$ and a natural transformation $F\to c(j_F)$.
\end{exercise}
Intuitively, a filtered category allows us to "coherently glue" data indexed by $J$. The colimit definite from $D: J\to \cC$ is called \emph{filtered colimit}. Filtered colimit can be defined by more explicit quotient instead of that of general colimit.
\begin{exercise}
  Show that for $J$ filtered $D:J\to\Set$, the filtered colimit $\Colim_J D = \left( \coprod_{j \in J} F(j)\right) / \sim$, where 
\[
    (x, j) \sim (y, k) \quad \text{if there exist morphisms } f : j \to l,\, g : k \to l \text{ in } J \text{ such that } D(f)(x) = D(g)(y).
    \]
\end{exercise}
  \begin{exercise}
   \begin{enumerate}
     \item Let $I,J$ be any small categories, consider $D: I \times J \to \cC$. Then show that: $\Lim_I\Lim_J D \cong \Lim_{I\times J} D \cong \Lim_J\Lim_I D$, same for the colimit. (You just need prove it for $\Set$.)
     \item Let $I$ be finite, and $J$ be filtered category, consider $D:I\times J \to \Set$. Then show that $\Lim_I\Colim_J D \cong \Colim_J\Lim_I D$. That is to say filtered colimit preserve finite limit.
   \end{enumerate} 
  \end{exercise}
Limit and Colimit are not necessarily always existing for all $D:J\to\cC$, but just like for a space $X$ we can define its completion $\hat{X}$ to make limit exist, we can define a (co)completion of a category $\cC$ to make (co)limit exists. An easy observation is limit and colimit are interchanged in $\cC$ and $\cC^\op$, so let us be focus on the case for colimit. Notice that limit and colimit are admitted for $\Set$, then so do presheaf category $\PSh(\cC)$

We first introduce the category of elements for a presheaf, which will be the diagram for a colim to assembly spaces.
\begin{definition}[Category of Elements]
  Let $\mathcal{C}$ be a category and let $\mathcal{F} : \mathcal{C}^{\mathrm{op}} \to \mathbf{Set}$ be a presheaf. The \emph{category of elements} of $\mathcal{F}$, denoted $\int_\cC \mathcal{F}$, is defined as follows:

\begin{itemize}
    \item \textbf{Objects:} Pairs $(C, x)$ where $C$ is an object of $\mathcal{C}$ and $x \in \mathcal{F}(C)$.
    \item \textbf{Morphisms:} A morphism $(C, x) \to (D, y)$ is a morphism $f : C \to D$ in $\mathcal{C}$ such that
    \[
    \mathcal{F}(f)(y) = x.
    \]
    (Note: since $\mathcal{F}$ is contravariant, the direction of $f$ is $C \to D$, but the induced map goes $\mathcal{F}(D) \to \mathcal{F}(C)$.)

    \item \textbf{Composition and identities:} Inherited from the category $\mathcal{C}$.
\end{itemize}
\end{definition}

\begin{example}[Category of Elements of Simplicial Set]
  Let $X: \Delta^\op\to \Set$ be a simplicial set, Then the category of elements $\int_\Delta X$ will be

\begin{itemize}
  \item \textbf{Objects:} $X([0])$ collection of points;$X([1])$ collection of segments;$X([3])$ collection of triangles, ...
  \item \textbf{Morphisms:} A morphism $ x \in X([n]) \to y \in X([n+1])$ is a morphism $\delta_i : [n] \to [n+1]$  such that $x$ is the $i$-th boundary of $y$, etc.
\end{itemize}
\end{example}
Intuitively we should think $\int_\cC \cF$ give us the blueprint to reassembly. For any functor $R:\cC \to \cD$, we should think \[
  \int_{C\in\cC} \cF(C) \times R(C) \left(\text{or } \int_{\cC} \cF \times R \right) := \Colim_{(C,x)\in\int_\cC \cF} R(C) \in \cD
\] 
Is the assembly of $\cF$ inside $\cD$.
\begin{exercise}
  Take the Yoneda embedding $\yo: \cC \to \PSh(\cC)$, we have the $\int_{\cC} \cF \times \yo \in \PSh(\cC)$. 
  \begin{enumerate}
    \item Show that for $B\in \cC$, we have a map 
      \[
      \cF(B) \to \int_{C\in\cC} \cF(C) \times \yo(C)(B)= \Colim_{(C,x)\in\int_\cC \cF} \Hom_\cC(B,C)
    \] 
    defined by
    \[
      b\in \cF(B) \mapsto ((B,b), \mathrm{id}_B) \in \Colim_{(C,x)\in\int_\cC \cF} \Hom_\cC(B,C)
    \]
    which is a bijection. (This is analogue to $ f(b) =\int_{c\in\bR} f(c)\delta(c-b)$)
  \item This extended to a natural transformation $\cF \to \int_{\cC} \cF \times \yo$ which is an isomorphism.
  \item Let $\cD$ be a cocomplete category(i.e. admitted all colimit), then there is a map between
    \[
      \Fun(\cC,\cD) \to \Fun^{\mathrm{cocont}}(\PSh(\cC),\cD)
    \]
    where $\Fun^{\mathrm{cocont}}$ means cocontinuous functor i.e. preserve colimit, the map is defined by 
    \[
      R \in \Fun(\cC,\cD) \mapsto \left( \cF \in \PSh(\cC) \mapsto  \int_{\cC} \cF \times R \in \cD\right)
    \]
    Show that this is a bijection. And in other words, $\yo:\cC\to\PSh(\cC)$ is the \emph{free cocompletion} of $\cC$.
  \end{enumerate}
\end{exercise}

\begin{example}[Dual Number]
  Let \emph{dual number}$D \in $ define as $ $ 
  intuitively 
Tangent bundle
\end{example}

Notice that even if $\cC$ is cocompletion, which dosen't means $ \cC \cong \PSh(\cC)$, because $\yo :\cC \cong \PSh(\cC) $ is not cocontinuous, i.e $\yo(\Colim C)\neq \Colim \yo( C)$ in general. This can also been seen from $ \cF \in \PSh$ is not continuous in general: \[
  \cF(\Colim C)=\Hom_{\PSh(\cC)}(\yo(\Colim C), \cF) \neq  \Hom_{\PSh(\cC)}(\Colim \yo(C), \cF)=\Lim \cF(C)
\] 
So if we impose some continuous condition, we can get subcategory of continuous presheaf, which are called sheaf, behaves more close to the test category $\cC$.

\begin{exercise}
  Show that for $B\in\cC$, $\yo(B)$ are continuous, i.e. $ \yo(B)(\Colim_{j\in J} C_j)\cong \Lim_{j\in J} \yo(B)(C_j)$. In others words $\yo(B)$ is a sheaf. 
\end{exercise}

\section{Sheaf and Coverage}

If we ask to presheaf be continuous for all colimit we will get nothing more that representable ones, instead we can restrict which kinds of colimit that it preserve. 

\begin{example}[Ind-Object]
  Let $\cC$ have all finite colimit (i.e for $C:J\to \cC$ with $J$ finite), Then the ind-object  is the presheaf that preserve finite colimit, i.e. $\cF(\Colim_J C)\cong \Lim_J \cF(C)$ for $J$ finite, this is also called \emph{left exact}. Let $\mathrm{ind}(\cC)\subset \PSh(\cC)$ be the subcategory of ind-object.
  \begin{exercise}
   \begin{enumerate}
    \item For any $J$ filtered and $D:J\to \cC$, show that $\Colim_J \yo(D) \in \PSh(\cC)$ is actually an ind-object. 
    \item* For any $ \cF \in \mathrm{ind}(\cC)$, show that the category of elements $\int_\cC \cF$ is filtered. This shows that $ \cF\cong \int_\cC \cF\yo$ is a filter colimit, and $\mathrm{ind}(\cC)$ is generated by representable presheaf with filtered colimit. 
   \end{enumerate} 
  \end{exercise}

\end{example}

In geometry setting, the colimit we want to preserve are come from coverage. We should first decide a class of open morphism in $\cC$, then we decide which collection of open morphism is a covering. Now for example consider a covering of $j_1: U_1 \to X \leftarrow U_2 :j_2$, intuitively, $X$ should identify to the pushout colimit $|U_{\bullet}|:=U_1 \sqcup_{U_1\cap U_2} U_2$. The presheaf preserve this colimit will satisfy
\[
  \cF(X) = \cF(U_1 \sqcup_{U_1\cap U_2} U_2) \cong \cF(U_1) \times_{\cF(U_1\cap U_2)}\cF(U_2)
\] 
The reason of consider this sheaf is because of locality, we want the generalized space $Y$ have can be tested locally, that is 
\[ \Map(X,Y) \cong \Map(U_1,Y)\times_{\Map(U_1\cap U_2,Y)}\Map(U_2,Y)=\left\{\substack{\text{maps from $U_1,U_2$ to $Y$} \\ \text{that coincide on $U_1\cap U_2$}}\right\}\]

Notice that the gluing $|U_{\bullet}|:=U_1 \sqcup_{U_1\cap U_2} U_2$ might not exists in $\cC$, but it always exists in $\PSh(\cC)$.

Let us definite it more formally 
\begin{definition}[Coverage(Grothendieck Topology)]
  Let $\mathcal{C}$ be a category. A \emph{coverage} $T$ on $\mathcal{C}$ assigns to each object $X \in \mathcal{C}$ a collection of families of morphisms $\{ U_i \to X \}_{i \in I}$, called \emph{covering families}, satisfying the following condition:

 If $\{ U_i \to X \}_{i \in I}$ is a covering family and $f : Y \to X$ is any morphism in $\mathcal{C}$, then there exists a covering family $\{ V_j \to Y \}_{j \in J}$ such that for each $j$, the morphism $V_j \to Y \xrightarrow{f} X$ factors through some $U_i \to X$.

 A category $\cC$ equip with a coverage $T$ is call a \emph{site} $(\cC,T)$. Given a covering families, $\{ U_i \to X \}_{i \in I}$, let $U_{ij}:= U_i \times_X U_j$, then the \emph{gluing} is the presheaf $|U_{\bullet}|:= \bigsqcup_{i\in I} \yo(U_i) / \sim_{\yo(U_{ij})} \in \PSh(\cC)$.
\end{definition}

With all these definition, we can finally define sheaf
\begin{definition}[Sheaf]
 Let $(\cC,T)$ be a site, then sheaf $\cF\in\Sh_T(\cC)\subset \PSh(\cC)$ is the presheaf preserve gluing, i.e. for any covering families, $\{ U_i \to X \}_{i \in I}$
   \[
     \cF(X)\cong \cF(|U_{\bullet}|) =\Hom_{\PSh(\cC)}(|U_{\bullet}|, \cF)= \Lim \Hom_{\PSh(\cC)}(U_{\bullet},\cF)=\Lim \cF(U_{\bullet})
   \] 
  Here \[
    \Lim \cF(U_{\bullet}) := \left\{ (f_i)\in \prod_{i\in I}\cF(U_{i}) \,\middle\vert\, f_i|_{U_{ij}}=f_j|_{U_{ij}}\in \cF(U_{ij})\right\}
  \] 
\end{definition}
When the coverage is clear, we can omit it to just write $ \Sh(\cC)$
We have a lot of examples.
\begin{example}[Sheaf on a Space]
  Let $X$ be a topological space, consider the usual coverage for $\Op(X)$: $\{ U_i \to U \}_{i \in I}$, is a covering family iff $ \bigcup_{i\in I} U_i =U$. Then we have the sheaf category $\Sh(X):= \Sh(\Op(X))$.
\end{example}

\begin{example}[Smooth Set]
  
\end{example}

\begin{example}[Zariski Site]
  
\end{example}

\begin{example}[Kan complex]
  
\end{example}
etale space

sheafication

slice category

Locally represent/Scheme

